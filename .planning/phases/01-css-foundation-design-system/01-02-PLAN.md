---
phase: 01-css-foundation-design-system
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - dashboard/src/layouts/CyberpunkLayout.tsx
  - dashboard/src/lib/lazy-3d.ts
  - dashboard/src/App.tsx
autonomous: false
requirements:
  - DS-07

must_haves:
  truths:
    - "All 6 existing pages render through CyberpunkLayout with cyberpunk color palette applied"
    - "Existing page functionality (routing, data loading, interactions) works identically to before"
    - "Background is dark void (#0a0608) instead of gray-950"
    - "Scanline overlay is visible as subtle CRT texture"
    - "lazy3D utility and Suspense3D component are available for future 3D imports"
    - "Architecture notes document single-canvas strategy and ref-based animation convention"
  artifacts:
    - path: "dashboard/src/layouts/CyberpunkLayout.tsx"
      provides: "Root layout with cyberpunk styling, scanlines, sidebar"
      contains: "CyberpunkLayout"
    - path: "dashboard/src/lib/lazy-3d.ts"
      provides: "React.lazy wrappers for 3D code splitting"
      contains: "lazy3D"
    - path: "dashboard/src/App.tsx"
      provides: "Router using CyberpunkLayout instead of DashboardLayout"
      contains: "CyberpunkLayout"
  key_links:
    - from: "dashboard/src/App.tsx"
      to: "dashboard/src/layouts/CyberpunkLayout.tsx"
      via: "Route element prop"
      pattern: "element=.*CyberpunkLayout"
    - from: "dashboard/src/layouts/CyberpunkLayout.tsx"
      to: "dashboard/src/components/Sidebar.tsx"
      via: "Component import and render"
      pattern: "import.*Sidebar"
    - from: "dashboard/src/layouts/CyberpunkLayout.tsx"
      to: "dashboard/src/styles/cyberpunk-vars.css"
      via: "Tailwind classes referencing --cyber-* vars"
      pattern: "bg-cyber-void|text-cyber-text"
---

<objective>
Create CyberpunkLayout wrapper that replaces DashboardLayout, build lazy-3d.ts utility for future 3D code splitting, and swap the route to use the new layout. Verify all 6 pages render correctly with the cyberpunk visual identity.

Purpose: Complete the progressive layout upgrade so all pages use the cyberpunk design system. Establish 3D architectural conventions that all future R3F work will follow.

Output: Working CyberpunkLayout rendering all 6 pages with cyberpunk palette, scanlines visible, and lazy-3d utility ready for Phase 5/6.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-css-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-css-foundation-design-system/01-01-SUMMARY.md

@dashboard/src/layouts/DashboardLayout.tsx
@dashboard/src/components/Sidebar.tsx
@dashboard/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CyberpunkLayout, lazy-3d utility, and swap route</name>
  <files>
    dashboard/src/layouts/CyberpunkLayout.tsx
    dashboard/src/lib/lazy-3d.ts
    dashboard/src/App.tsx
  </files>
  <action>
1. Create `dashboard/src/layouts/CyberpunkLayout.tsx`:
   - Progressive enhancement of DashboardLayout -- same structure (flex h-screen, Sidebar + Outlet) but with cyberpunk classes
   - Apply `bg-cyber-void text-cyber-text` instead of `bg-gray-950 text-white`
   - Add `scanlines` class to the root div (enables the CRT overlay from scanlines.css)
   - Import `Sidebar` from `../components/Sidebar` (same as DashboardLayout)
   - Import `Outlet` from `react-router-dom`
   - Export as named export `CyberpunkLayout`

   ```tsx
   import { Outlet } from 'react-router-dom';
   import { Sidebar } from '../components/Sidebar';

   export function CyberpunkLayout() {
     return (
       <div className="flex h-screen bg-cyber-void text-cyber-text scanlines">
         <Sidebar />
         <main className="flex-1 overflow-y-auto p-6">
           <Outlet />
         </main>
       </div>
     );
   }
   ```

   IMPORTANT: Do NOT delete DashboardLayout.tsx -- keep it for rollback safety. It can be removed in a later phase.

2. Create `dashboard/src/lib/lazy-3d.ts`:
   - `lazy3D` function: typed wrapper around React.lazy for 3D component imports
   - `Suspense3D` component: Suspense boundary with consistent fallback
   - Architecture documentation comments:
     a. SINGLE CANVAS STRATEGY: Use ONE `<Canvas>` at CyberpunkLayout level, never per-page
     b. REF-BASED ANIMATION: Always useRef inside useFrame, never setState
     c. LAZY LOADING: All R3F/Three.js imports MUST go through lazy3D() or dynamic import()

   Use the exact implementation from 01-RESEARCH.md "lazy-3d.ts Utility" section. Ensure proper TypeScript types with `ComponentType` and `ReactNode` imports.

3. Update `dashboard/src/App.tsx`:
   - Change import from `DashboardLayout` to `CyberpunkLayout`:
     `import { CyberpunkLayout } from './layouts/CyberpunkLayout';`
   - Change the Route element from `<DashboardLayout />` to `<CyberpunkLayout />`
   - Keep ALL other imports and routes EXACTLY as they are (Dashboard, Leads, Queue, Analytics, Experiments, Settings)
   - Keep QueryClient configuration unchanged

IMPORTANT:
- The Sidebar component still uses gray-700/gray-900/blue-600 Tailwind classes. That is expected -- Sidebar will be upgraded in Phase 2 (NeonSidebar). Do NOT modify Sidebar in this plan.
- All 6 page components remain unchanged. They still use gray-* classes internally. That is correct -- pages will be upgraded in Phases 4 and 6.
- This plan only swaps the outer layout shell. Interior content stays the same.
  </action>
  <verify>
    <automated>cd dashboard && npx tsc --noEmit 2>&1 | head -20 && npx vite build 2>&1 | tail -5 && grep -q "CyberpunkLayout" src/App.tsx && echo "Route swap OK" && grep -q "lazy3D" src/lib/lazy-3d.ts && echo "lazy-3d OK" && grep -q "scanlines" src/layouts/CyberpunkLayout.tsx && echo "Scanlines applied" && test -f src/layouts/DashboardLayout.tsx && echo "Old layout preserved"</automated>
    <manual>Run `npm run dev`, open http://localhost:5173. Verify: (1) Dark void background visible, (2) Subtle scanline texture visible, (3) All 6 sidebar links navigate correctly, (4) Page content renders (Dashboard cards, Analytics charts, etc.), (5) No broken click/hover interactions.</manual>
  </verify>
  <done>
    - CyberpunkLayout renders with bg-cyber-void, text-cyber-text, and scanlines class
    - All 6 routes use CyberpunkLayout as their parent layout element
    - DashboardLayout.tsx preserved for rollback safety
    - lazy3D and Suspense3D exported from lib/lazy-3d.ts
    - Architecture notes for single-canvas, ref-based animation, and lazy loading documented
    - TypeScript compiles, Vite builds
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of cyberpunk layout</name>
  <files>dashboard/src/layouts/CyberpunkLayout.tsx</files>
  <action>
Human visual verification of the complete Phase 1 output. No code changes -- this is a review gate.

What was built (Plan 01 + Plan 02 Task 1):
- Cyberpunk oklch color palette applied via CSS custom properties
- Glassmorphism utility classes available (.glass, .glass-strong, .glass-hover)
- Neon glow utility classes available (.neon-glow)
- CRT scanline overlay visible across all pages
- JetBrains Mono font loaded (visible in browser dev tools under font-mono)
- All 6 pages routing through CyberpunkLayout

Steps to verify:
1. Run `cd dashboard && npm run dev`
2. Open http://localhost:5173 in your browser
3. **Background color:** Should be very dark (near-black with slight warm tint, not neutral gray)
4. **Scanlines:** Look closely -- subtle horizontal line texture should be visible across the entire page (very faint, not distracting)
5. **Navigation:** Click through all 6 sidebar links (Dashboard, Leads, Queue, Analytics, Experiments, Settings) -- each should render its content
6. **No broken interactions:** Click buttons, hover over elements -- nothing should be blocked by the scanline overlay
7. **Browser DevTools check (optional):** Inspect any element, check Computed styles -- you should see `--cyber-void`, `--cyber-pink` etc. in the :root variables

Note: The Sidebar still has gray/blue colors (not yet cyberpunk-styled). Interior page content also uses gray colors. This is expected -- those are upgraded in Phases 2, 4, and 6.

Resume signal: Type "approved" to continue to Phase 2, or describe any visual issues to fix.
  </action>
  <verify>
    <automated>cd dashboard && npx vite build 2>&1 | tail -3</automated>
    <manual>Human confirms: dark void background, visible scanlines, all 6 pages navigate, no broken interactions</manual>
  </verify>
  <done>Human has visually confirmed the cyberpunk design system is correctly applied and all pages render without regression.</done>
</task>

</tasks>

<verification>
1. `cd dashboard && npx tsc --noEmit` -- TypeScript compiles (CyberpunkLayout, lazy-3d, App all type-check)
2. `cd dashboard && npx vite build` -- Build succeeds (no missing imports or CSS errors)
3. `grep "CyberpunkLayout" dashboard/src/App.tsx` -- Route uses new layout
4. `grep "DashboardLayout" dashboard/src/layouts/DashboardLayout.tsx` -- Old layout preserved
5. `grep "lazy3D" dashboard/src/lib/lazy-3d.ts` -- Lazy utility available
6. `grep "SINGLE CANVAS" dashboard/src/lib/lazy-3d.ts` -- Architecture notes present
7. Manual: All 6 pages render, scanlines visible, no interaction blocking
</verification>

<success_criteria>
- CyberpunkLayout replaces DashboardLayout as the active route layout
- Background is dark void (oklch), not gray-950
- Scanline CRT overlay visible across all pages
- All 6 pages render and navigate correctly (no regression)
- lazy-3d.ts exports lazy3D and Suspense3D with full TypeScript types
- Architecture comments document single-canvas, ref-based animation, lazy loading conventions
- DashboardLayout.tsx still exists (rollback safety)
- Human visually confirms the cyberpunk appearance
</success_criteria>

<output>
After completion, create `.planning/phases/01-css-foundation-design-system/01-02-SUMMARY.md`
</output>
